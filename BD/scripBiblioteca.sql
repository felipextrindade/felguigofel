CREATE TABLE SOCIOS(
CODIGO NUMBER(19) CONSTRAINT PK_CODIGO_SOCIOS PRIMARY KEY,
NOME VARCHAR(40) NOT NULL,
TELEFONE VARCHAR(20) NOT NULL,
LOGRADOURO VARCHAR(30) NOT NULL,
COMPLEMENTO VARCHAR(15),
BAIRRO VARCHAR(15),
CIDADE VARCHAR(20),
UF VARCHAR(2),
CEP VARCHAR(8));

CREATE TABLE ASSUNTOS(
CODIGO NUMBER(19) CONSTRAINT PK_CODIGO_ASSUNTOS PRIMARY KEY,
NOME VARCHAR(40) NOT NULL CONSTRAINT UK_NOME_ASSUNTOS UNIQUE);

CREATE TABLE AUTORIAS(
IDLIVRO VARCHAR(15),
CODAUTOR NUMBER(19), 
CONSTRAINT PK_IDLIVRO_CODAUTOR_AUTORIAS PRIMARY KEY (IDLIVRO,CODAUTOR));

CREATE TABLE AUTORES(
CODIGO NUMBER(19) CONSTRAINT PK_CODIGO_AUTORES PRIMARY KEY,
NOME VARCHAR(40) NOT NULL,
ORIGEM VARCHAR(20) NOT NULL);

CREATE TABLE EMPRESTIMOS(
IDLIVRO VARCHAR(15),
CODSOCIO NUMBER(19),
DTRETIRADA DATE NOT NULL,
DTDEVPREV DATE NOT NULL,
DTDEVREAL DATE,
VRMULTA FLOAT CONSTRAINT CK_VRMULTA_EMPRESTIMO CHECK(VRMULTA >=0),
CONSTRAINT PK_IDLIVRO_CODSOCIO_DTRETIRADA PRIMARY KEY(IDLIVRO,CODSOCIO,DTRETIRADA));

CREATE TABLE LIVROS(
IDD VARCHAR(15) CONSTRAINT PK_ID_LIVROS PRIMARY KEY,
TITULO VARCHAR(80) NOT NULL,
EDITORA VARCHAR(20) NOT NULL,
TOTPAG INT CONSTRAINT CK_TOTPAG_LIVROS CHECK(TOTPAG>0),
DIASPRAZO INT CONSTRAINT CK_DIASPRAZO_LIVROS CHECK(DIASPRAZO>=0),
CODASSUNTO NUMBER(19) NOT NULL);

ALTER TABLE AUTORIAS ADD CONSTRAINT FK_IDLIVRO_AUTORIAS FOREIGN KEY (IDLIVRO) REFERENCES LIVROS(IDD);
ALTER TABLE AUTORIAS ADD CONSTRAINT FK_CODAUTOR_AUTORIAS FOREIGN KEY (CODAUTOR) REFERENCES AUTORES(CODIGO);

ALTER TABLE EMPRESTIMOS ADD CONSTRAINT FK_IDLIVRO_EMPRESTIMOS FOREIGN KEY (IDLIVRO) REFERENCES LIVROS(IDD);
ALTER TABLE EMPRESTIMOS ADD CONSTRAINT FK_CODSOCIO_EMPRESTIMOS FOREIGN KEY (CODSOCIO) REFERENCES SOCIOS(CODIGO);

ALTER TABLE LIVROS ADD CONSTRAINT FK_CODASSUNTO_LIVROS FOREIGN KEY (CODASSUNTO) REFERENCES ASSUNTOS(CODIGO);

INSERT INTO ASSUNTOS (CODIGO, NOME) VALUES ('01','MICROBIOLOGIA');
INSERT INTO ASSUNTOS (CODIGO, NOME) VALUES ('02','PROGRAMA!O');
INSERT INTO ASSUNTOS (CODIGO, NOME) VALUES ('03','MATERIAIS');
INSERT INTO ASSUNTOS (CODIGO, NOME) VALUES ('04','FISIOLOGIA');
INSERT INTO ASSUNTOS (CODIGO, NOME) VALUES ('05','USINAGEM');
INSERT INTO ASSUNTOS (CODIGO, NOME) VALUES ('07','BANCO DE DADOS');
INSERT INTO ASSUNTOS (CODIGO, NOME) VALUES ('08','CALCULO');

INSERT INTO LIVROS (IDD, TITULO, EDITORA, TOTPAG, CODASSUNTO) VALUES ('737.4.202 S2002','OS BICHOS SÏ ASSIM','LTC ANO:1990','300','01');
INSERT INTO LIVROS (IDD, TITULO, EDITORA, TOTPAG, CODASSUNTO) VALUES ('681.5.203 S442','TECNICAS DE PROGRAMA!O ESTRUTURADA','CAMPUS ANO:1992','253','02');
INSERT INTO LIVROS (IDD, TITULO, EDITORA, TOTPAG, CODASSUNTO) VALUES ('588.9.949 S3003','ENSAIOS DE DUREZA E DE MOLEZA','LTC ANO:1993','330','03');
INSERT INTO LIVROS (IDD, TITULO, EDITORA, TOTPAG, CODASSUNTO) VALUES ('737.4.234 S2323','O FUNCIONAMENTO DO INTESTINO','GLOBO ANO:1990','300','04');
INSERT INTO LIVROS (IDD, TITULO, EDITORA, TOTPAG, CODASSUNTO) VALUES ('588.3.342 S4343','TORNO RADIAL: COMO FUNCIONA A COISA','LTC ANO:1994','505','05');
INSERT INTO LIVROS (IDD, TITULO, EDITORA, TOTPAG, CODASSUNTO) VALUES ('737.4.180 S2023','BACT?IAS, MICR?IOS E COISAS PARECIDAS','ERIKA ANO:1989','300','01');
INSERT INTO LIVROS (IDD, TITULO, EDITORA, TOTPAG, CODASSUNTO) VALUES ('683.2.343 S334','TEORIA DE BANCO DE DADOS','CAMPUS ANO:1990','450','07');
INSERT INTO LIVROS (IDD, TITULO, EDITORA, TOTPAG, CODASSUNTO) VALUES ('333.5.656 S1849','CALCULO DIFERENCIAL E INTEGRAL','LTC ANO:1990','300','08');

INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('01','SILVA, JOS?DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('02','SILVA, VANDERLEI DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('03','SILVA, JOÏ DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('04','SILVA, PEDRO DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('05','SILVA, ANA DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('06','SILVA, ANTONIO DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('07','SILVA, JOAQUIM DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('08','SILVA, MARIA DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('09','SILVA, ARLETE DA','BRASIL');
INSERT INTO AUTORES (CODIGO, NOME, ORIGEM) VALUES ('10','SILVA, TEOBALDO DA','BRASIL');

INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('737.4.202 S2002','01');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('737.4.202 S2002','02');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('681.5.203 S442','03');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('588.9.949 S3003','04');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('737.4.234 S2323','05');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('588.3.342 S4343','06');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('588.3.342 S4343','07');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('588.3.342 S4343','04');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('737.4.180 S2023','08');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('737.4.180 S2023','02');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('683.2.343 S334','10');
INSERT INTO AUTORIAS (IDLIVRO, CODAUTOR) VALUES ('333.5.656 S1849','09');

CREATE TABLE EDITORA(
CODEDITORA NUMBER(2),
EDITORA VARCHAR(50),
CIDADE VARCHAR(25));

DROP SEQUENCE SEQ_EDITORA1;

CREATE SEQUENCE SEQ_EDITORA1;

INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'ACADEMICA','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'ALTA BOOKS','RIO DE JANEIRO, RJ');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'ATICA','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'ATLAS','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'ATUAL','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'AXCELL BOOKS','RIO DE JANEIRO, RJ');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'BERKELY','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'BOOKMAN','PORTO ALEGRE, RS');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'BRASILIENSE','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'BRASPORT','RIO DE JANEIRO, RJ');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'CAMPUS','RIO DE JANEIRO, RJ');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'CIÊNCIA MODERNA','RIO DE JANEIRO, RJ');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'COMPANIA DAS LETRAS','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'CORTEZ EDITORA','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'CULTRIX','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'EDGAR BLÜCHER','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'EDIÇÕES PAULINAS','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'EDITORA DA FGV','RIO DE JANEIRO, RJ');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'EDITORA DA UNICAMP','CAMPINAS, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'EDITORA DA SEBRAE','BRASILIA, DF');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'ERIKA','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'LTC','SÃO PAULO, SP');
INSERT INTO EDITORA (CODEDITORA, EDITORA, CIDADE) VALUES (SEQ_EDITORA1.NEXTVAL,'GLOBO','SÃO PAULO, SP');

ALTER TABLE LIVROS DROP COLUMN EDITORA;

ALTER TABLE LIVROS ADD EDITORA NUMBER(2);
ALTER TABLE EDITORA ADD CONSTRAINT PK_EDITORA PRIMARY KEY (CODEDITORA);
ALTER TABLE LIVROS ADD CONSTRAINT FK_EDITORA FOREIGN KEY (EDITORA) REFERENCES EDITORA(CODEDITORA);

UPDATE LIVROS
SET Editora = 21
WHERE IdD = '737.4.202 S2002';
UPDATE LIVROS
SET Editora = 11
WHERE IdD = '681.5.203 S442';
UPDATE LIVROS
SET Editora = 21
WHERE IdD = '588.9.949 S3003';
UPDATE LIVROS
SET Editora = 22
WHERE IdD = '737.4.234 S2323';
UPDATE LIVROS
SET Editora = 21
WHERE IdD = '588.3.342 S4343';
UPDATE LIVROS
SET Editora = 23
WHERE IdD = '737.4.180 S2023';
UPDATE LIVROS
SET Editora = 11
WHERE IdD = '683.2.343 S334';
UPDATE LIVROS
SET Editora = 21
WHERE IdD = '333.5.656 S1849';

SELECT * FROM LIVROS;

DROP TABLE LIVROS_ASSUNTO;

CREATE TABLE LIVROS_ASSUNTO(
IDLIVRO VARCHAR(15),
IDASSUNTO NUMBER (19,0));

ALTER TABLE LIVROS_ASSUNTO ADD CONSTRAINT FK_ASSUNTO FOREIGN KEY (IDASSUNTO) REFERENCES ASSUNTOS(CODIGO);
ALTER TABLE LIVROS_ASSUNTO ADD CONSTRAINT FK_LIVRO FOREIGN KEY (IDLIVRO) REFERENCES LIVROS(IDD);

INSERT ALL
  INTO LIVROS_ASSUNTO (IDLIVRO, IDASSUNTO) 
  VALUES('737.4.202 S2002', 1)
  INTO LIVROS_ASSUNTO (IDLIVRO, IDASSUNTO) 
  VALUES('681.5.203 S442', 2)
  INTO LIVROS_ASSUNTO (IDLIVRO, IDASSUNTO) 
  VALUES('588.9.949 S3003', 3)
  INTO LIVROS_ASSUNTO (IDLIVRO, IDASSUNTO) 
  VALUES('737.4.234 S2323', 4)
  INTO LIVROS_ASSUNTO (IDLIVRO, IDASSUNTO) 
  VALUES('588.3.342 S4343', 5)
  INTO LIVROS_ASSUNTO (IDLIVRO, IDASSUNTO) 
  VALUES('737.4.180 S2023', 1)
  INTO LIVROS_ASSUNTO (IDLIVRO, IDASSUNTO) 
  VALUES('683.2.343 S334', 7)
  INTO LIVROS_ASSUNTO (IDLIVRO, IDASSUNTO) 
  VALUES('333.5.656 S1849', 7)
SELECT * FROM DUAL;

SELECT * FROM LIVROS_ASSUNTO;

ALTER TABLE LIVROS DROP COLUMN CODASSUNTO;



